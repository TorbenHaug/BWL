<%
  def product_structure_output_list(article, parent_amount, accu)
    lower_parts = ArticleStructure.where(upper_part: article)
    if (!lower_parts.empty?)
      accu.push("<ul>")
    end

    lower_parts.each {|item|
      count = parent_amount * item.amount
      accu.push("<li style=\"margin-bottom: 10px;\">" + count.to_s + "x " + link_to(item.lower_part.name, item.lower_part) + "</li>")
      product_structure_output_list(item.lower_part, count, accu)
    }

    if (!lower_parts.empty?)
      accu.push("</ul>")
    end

    return accu
  end

  def association_rule_learning_admin(association_rule_learning_data)
    return association_rule_learning_data
  end

  def association_rule_learning_user(association_rule_learning_data)
    return association_rule_learning_data
  end
%>



<div class="post">
    <table style="width: 100%;">
        <tr>
            <td><h1><%= @article.name %></h1></td>
            <td width="180px" height="150px" align="right"><%= image_tag @article.photo.url(:small) %></td>
        </tr>
    </table>

    <div class="post" style="margin-top: 30px;">
        <p>
          <strong>Produktbezeichnung:<br/></strong>
          <%= @article.name %>
        </p>

        <p>
          <strong>Produktbeschreibung:<br/></strong>
          <%= @article.description %>
        </p>

        <p>
          <strong>Preis:</strong>
          <%= float_to_euro_string(@article.price) %>
        </p>
        
        <% association_rule_learning_data = [] %>
        <% if (!association_rule_learning_data.empty?) %>
            <%= viewtag_seperator %>
            <% if (admin_user?) %>
                <strong>Assoziationsanalyse:</strong>
                <table>
                    <% association_rule_learning_admin(association_rule_learning_data).each {|line| %>
                        <%= line.html_safe %>
                    <%} %>
                </table>
            <% else %>
                <strong>Kunden, die diesen Artikel gekauft haben, kauften auch:</strong>
                <table>
                    <% association_rule_learning_user(association_rule_learning_data).each {|line| %>
                        <%= line.html_safe %>
                    <%} %>
                </table>
            <% end %>
        <% end %>
        
        <% product_structure_output = product_structure_output_list(@article, 1, []) %>
        <% if (!product_structure_output.empty?) %>
            <%= viewtag_seperator %>
            <p>
                <strong>Strukturstückliste:</strong><br/>
                <% product_structure_output.each {|line| %>
                    <%= line.html_safe %>
                <%} %>
            </p>
        <% end %>

        <% if (admin_user?) %>
            <%= viewtag_seperator %>
            <p>
              <strong>Erstellt am:</strong>
              <%= get_german_date_time_ordinal(@article.created_at.to_datetime) %>
            </p>

            <% if (!@article.deleted_at.nil?) %>
              <p>
                <strong>Gelöscht am:</strong>
                <%= get_german_date_time_ordinal(@article.deleted_at.to_datetime) %>
              </p>
            <% end %>
            
            <p>
              <%= viewtag_admin %><br/>
              <%= link_to 'Bearbeiten', edit_article_path(@article) %> | 
              <%= link_to 'Zurück', articles_path %>
            </p>
        <% end %>    
    </div>
</div>
