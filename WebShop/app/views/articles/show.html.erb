<%
  def product_structure_output_list(article, parent_amount, accu)
    lower_parts = ArticleStructure.where(upper_part: article)
    if (!lower_parts.empty?)
      accu.push("<ul>")
    end

    lower_parts.each {|item|
      count = parent_amount * item.amount
      accu.push("<li>" + count.to_s + "x <strong>" + item.lower_part.name.to_s + "</strong></li>")
      product_structure_output_list(item.lower_part, count, accu)
    }

    if (!lower_parts.empty?)
      accu.push("</ul>")
    end

    return accu
  end
%>



<div class="post">
    <div style="height: 150px;">
        <span style="float: right;"><%= image_tag @article.photo.url(:small) %></span>
        <h1 style="padding-top: 30px; padding-right: 180px;"><%= @article.name %></h1>
    </div>

    <div class="post">
        <p>
          <strong>Produktbezeichnung:<br/></strong>
          <%= @article.name %>
        </p>

        <p>
          <strong>Produktbeschreibung:<br/></strong>
          <%= @article.description %>
        </p>

        <p>
          <strong>Preis:</strong>
          <%= float_to_euro_string(@article.price) %>
        </p>

        <% if (admin_user?) %>
            <p>
              <strong>Created at:<br/></strong>
              <%= @article.created_at %>
            </p>

            <p>
              <strong>Deleted at:<br/></strong>
              <%= @article.deleted_at %>
            </p>
        <% end %>

        <p>
          <% product_structure_output = product_structure_output_list(@article, 1, []) %>
          <% if (!product_structure_output.empty?) %>
            <strong>Strukturstückliste:</strong><br/>
            <% product_structure_output.each {|line| %>
              <%= line.html_safe %> <br/>
            <%} %>
          <% end %>
        </p>

        <% if (admin_user?) %>
            <%= link_to 'Bearbeiten', edit_article_path(@article) %> | 
            <%= link_to 'Zurück', articles_path %>
        <% end %>
    </div>
</div>
